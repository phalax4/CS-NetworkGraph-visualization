<base href="http://www.cs.utexas.edu/~gouda/cs356sp09/midterm1/">
------------------------------------------------------------------------------
Mohamed G. Gouda                                                CS 356
Spring 2009                                                 	Midterm 1
------------------------------------------------------------------------------
Open Book                                                       75 minutes
------------------------------------------------------------------------------
All three problems in this midterm are related. Please read all problems 
carefully before you start answering any of them.

-------------------------------------------------------------------------------
1. (7 points)
A banking protocol involves n+1 processes: a bank process b and an array of n 
client processes c [i : 0..n-1]. The value of n is assumed to be at
least 2. When a process c[i] is ready, c[i] can send to process b, either 
a balance message, asking for the current balance of its account, or a 
transfer(j) message, asking that exactly one money unit be transferred from  
its own account to the account of process c[j], where j is different from
i. After sending a message, process c[i] becomes not ready until it receives 
a reply(r) message from process b, where r is the current balance of the 
account of process c[i]. Process c[i] becomes ready again after it receives
the reply(r) message from process b. A partial specification of process c[i]
is as follows.

process c[i : 0..n-1]			{n >= 2}

var 	acc    : integer,		{the current balance of the account}
					{of process c[i]; initially        }
					{    acc in c[i] = accnt[i] in b   }
    	ready  : boolean,		{initially true}
    	j      : 0..n-1,
    	r      : integer

begin

	ready 				--> S.0
[]	ready ^ acc>0 			--> S.1
[]	rcv reply(r) from b 		--> S.2
end

Specify statements S.0, S.1, and S.2 in process c[i].


Solution:

S.0  ready := false;
     send balance to b

S.1  ready, j := false, any;
     if j =i -> j := i +n 1
     [] j!=i -> skip
     fi; send transfer(j) to b

S.2  ready, acc := true, r

-------------------------------------------------------------------------------

2. (7 points)
Process b in the banking protocol, discussed above, has an array accnt of n 
elements, where the value of accnt[i] is the current balance of the account of
process c[i]. When b receives a balance message from c[i], then b sends a 
reply(accnt[i]) to c[i]. When b receives a transfer(j) from c[i], then b checks
the value of accnt[i]. If accnt[i]=0, then b decides not to execute the 
transfer of money from accnt[i] to accnt[j]. If accnt[i]>0, then b decides
nondeterministically whether or not to execute the transfer of money. If b
decides to execute the transfer of money from accnt[i] to accnt[j], then b
decrements accnt[i] by one and increments accnt[j] by one. If b decides not to
execute the transfer of money, then b leaves both accnt[i] and accnt[j] 
unchanged. At the end, b sends a reply(accnt[i]) message back to c[i]. A 
partial specification of process b is as follows.

process b

const	n				{n >= 2}

var 	accnt  : array [0..n-1] of integer,		
					{initially,                        }
					{    acc in c[i] = accnt[i] in b   }
    	j      : 0..n-1,
par    	i      : integer

begin

	rcv balance from c[i]		--> S.0
[]	rcv transfer(j) from c[i]	--> S.1
end
 
Specify statements S.0 and S.1 in process b.

Solution:

S.0  send reply(accnt[i]) to c[i]

S.1  if i!=j -> if c[i]>=0 -> skip
                [] c[i] >0 -> accnt[i], accnt[j]:=
                              accnt[i]-1, accnt[j]+1
                fi
     [] i=j  -> skip
     fi; send reply(accnt[i]) to c[i]

------------------------------------------------------------------------------
3. (6 points)
Assuming that transmitted messages can be lost (but neither corrupted nor
reordered), add a timeout action to process c[i], which you specified as a 
solution of problem 1 to make the protocol error-tolerant.

Solution:

timeout ~ready ^ (#ch.c[i].b + #ch.b.c[i] = 0) ->
        send balance to b
------------------------------------------------------------------------------ 
